
Описание (спецификация) формата файлов EXCELLON.
============================================

Введение и общие сведения.
--------------------------

EXCELLON - специализированный формат данных (и соответствующих файлов, в которые такой поток данных
может быть сохранён), предназначенный для сохранения особого рода технологической информации - карты
сверловки отверстий на плоской поверхности. Хотя первоначально он был предназначен для работы с
одним вполне конкретным семейством сверлильных станков с ЧПУ, но со временем он стал "стандартом де-факто"
для экспорта такого рода информации из различных автономных комплексных радиотехнических САПР с целью
направления их на предприятие-изготовитель, для передачи их на вход производственной технологической
цепочки.

Форматы GERBER и EXCELLON - два основных типа такого рода файлов, представляющих собой выходной результат
разработки, предназначенный для связи её информационно-проектировочного этапа с этапом заводским,
промышленно-технологическим. Для файлов EXCELLON также можно предложить наглядное представление в виде
кругов, положение которых совпадает с положением требуемого отверстия, а диаметр соответствует диаметру
применяемого сверла. Именно в виде такого представления отображает файл сверловки EXCELLON
просмотрщик-конвертер ПиКАДоГляд.

Файлы типа EXCELLON, как и GERBER, текстовые, частично человекочитаемые, хотя и не предназначены для
непосредственного составления или редактирования человеком. Все их внутренние структуры представляют
собой ASCII-текст, состоящий из буквенных команд (буквы латинского алфавита, в упрощённом варианте
команды однобуквенные) и их числовых параметров, записанных также как текстовые представления целых
или дробных чисел.

Описание подмножества формата EXCELLON, поддерживаемого DOS PCAD и программой ПиКАДоГляд.
---------------------------------------------------------------------------------------

Формат EXCELLON предложен и развивается своим создателем на протяжении очень длительного времени.
Как и любые промышленные форматы, он развивается накопительно, с добавлением в стандарт всё большего
количества команд и функций. На данный момент он уже принял совершенно необъятный характер, поэтому
тут не делается даже попытки поддержать его сколь-нибудь полно. Поддерживается только незначительное
подмножество его команд, которое используется при генерации файлов сверловки программой PC-DRILL,
входящей в состав САПР DOS PCAD. Так как именно эта программа и применяется обычно для создания
выходных EXCELLON-файлов при работе в среде PCAD, то даже такой ограниченной поддержки должно быть
достаточно для достижения главной цели программы ПиКАДоГляд - просмотра и преобразования данных,
циркулирующих вокруг программного комплекса DOS PCAD, а также порождаемых им для внешнего
использования.

Файл формата EXCELLON состоит из набора отдельных строк. Разделение строк осуществляется, как правило,
в стиле DOS/Windows, т. е. строки отделяются друг от друга парой символов CrLf ("\r\n"). Каждая строка
содержит в своём теле одну EXCELLON-команду. Команда, в свою очередь, состоит из набора групп. А группы
представляют собой совокупность из двух смежных элементов - однобуквенного префикса, определяющего тип
команды или группы, а также числового параметра который может быть как целочисленным (в большей части
случаев), так и дробным. Числа записываются в виде обычного их текстового представления, для записи
дробных чисел применяется формат с фиксированной децимальной точкой.

В файл также могут включаться строки, начинающиеся с символа / (прямого слеша). Они могут иметь специальное
значение для некоторых систем, но просмотрщиком при загрузке такие строки игнорируются.

ПиКАДоГляд поддерживает только немногие команды, которые перечислены ниже. Наличие в файле других команд
считается ошибкой и приводит к аварийному завершению открытия такого файла. Список поддерживаемых команд
выглядит так:

* M30 - окончание работы
* M71 - установка "квазиметрической" системы координат
* M72 - установка дюймовой системы координат
* TnnCd.ddd - смена сверла
* XxxxxYyyyy - сверление отверстия

Перед первой построительной командой должна быть выбрана одна из двух возможных систем измерения расстояний.
Делать это можно только один раз. При нарушении любого из этих условий возникнет ошибка загрузки такого файла.
В дюймовой системе координат единицей измерения расстояний является десятитысячная дюйма (одна десятая мила).
В "квазиметрической" системе расстояния измеряются в специфических единицах, которые можно перевести в миллиметры
делением числа на 101.6. Такой странный коэффициент получается умножением количества миллиметров в дюйме
(25.4 мм на дюйм) на 4.

Команда TnnCd.ddd изменяет текущее активное сверло. Его условный номер равен nn (целое число), а диаметр -
d.ddd миллиметров (дробное число с фиксированной точкой, задаётся всегда в миллиметрах). Допускается и
сокращённая версия такой команды в виде Tnn, без указания диаметра сверла. В этом случае диаметр сверла
принимается равным последнему значению, установленному для данного сверла полной формой команды T.

Команда XxxxxYyyyy создаёт отверстие в точке с координатами (xxxx, yyyy). Координаты - целые числа, а величина
координатной единицы зависит от типа рабочей системы координат, правила её определения описаны выше.
Поддерживаются также сокращённые формы команды сверления, с указанием только одной координаты X или Y. В
этом случае вторая координата полагается равной её текущему значению, установленному последней командой сверления,
содержащей эту координату.

Анализ конкретного примера данных в формате EXCELLON.
---------------------------------------------------

Вот небольшая выдержка из файла в формате EXCELLON:

/DBGRID 1  
/DBUNIT 2  
M72  
T2C1.000  
X001500Y004500  
X003500Y004500  
T3C0.800  
X002500Y002000  
X-002500Y-003500  
M30

Первые две строки - сервисные команды PCAD, при загрузке файла они будут пропущены. Третья строка содержит
команду M72, устанавливающую дюймовую систему координат. Следующая команда - T2C1.000 - устанавливает текущее
сверло с номером 2 и диаметром 1 мм. Затем следуют команды сверления двух отверстий в точках
(X = 001500, Y = 004500) и (X = 003500, Y = 004500). Далее очередное переключение сверла с номером 3 и диаметром
0.8 мм. Далее ещё два отверстия - (X = 002500, Y = 002000) и (X = -002500, Y = -003500). Обратите внимание, что
координаты второго отверстия отрицательны и предваряются знаком 'минус'('-'). Наконец, следует команда M30
завершения работы и окончания построения изображения.
