
Описание (спецификация) формата файлов GERBER.
============================================

Введение и общие сведения.
--------------------------

Первоначально GERBER представлял собой специализированный формат потока данных, который
воспринимался фотокоординатографами(фотоплоттерами) одноимённой фирмы. Но позднее файлы,
содержащие данные в этом формате, превратились в некий "франка лингва", протокол взаимообмена
информацией между самыми разнообразными программами и устройствами, вовлечёнными в процесс
изготовления печатных плат, а также других изделий, производимых по аналогичным технологиям.

В частности, в средах DOS PCAD именно такой формат порождается программой PC-PHOTO и служит
одним из основных конечных выходных информационных файлов, описывающих разработанное радиоэлектронное
устройство и подлежащих передаче непосредственно на производство, на вход его технологической цепочки.
Такой файл в некотором смысле суммирует весь предыдущий процесс разработки радиоэлектронного устройства
посредством комплекса САПР PCAD, является итогом работы всех прочих его программ и труда разработчика.

Формат GERBER может быть расширяемым и весьма разнообразным, но просмотрщик ПиКАДоГляд поддерживает его
лишь в ограниченном варианте, допуская и обрабатывая только то подмножество возможных команд формата,
которое непосредственно используется САПР DOS PCAD и содержится в порождаемых ей файлах.

Описание подмножества формата GERBER, поддерживаемого DOS PCAD и программой ПиКАДоГляд.
---------------------------------------------------------------------------------------

Файлы в формате GERBER являются средством описания векторных изображений. Как и все векторные изображения,
здесь они состоят из отдельных графических примитивов, каждый из которых представляет собой специальную
математическую модель, параметры которой извлекаются из соответствующей команды потока данных.
Элементно-примитивный состав GERBER-файлов (в том виде, в котором они поддерживаются программой) весьма
беден: он состоит лишь из двух различных примитивов - отрезка прямой и уединённой засветки (апертуры).
Все прочие возможные элементы чертежа приводятся (разлагаются) к набору из этих двух примитивов в процессе
синтеза файла. В составе комплекса программ САПР DOS PCAD эту операцию выполняет программа PC-PHOTO.

Файлы типа GERBER текстовые, частично человекочитаемые, хотя и не предназначены для непосредственного
составления или редактирования человеком. Все их внутренние структуры представляют собой ASCII-текст,
состоящий из буквенных команд (буквы латинского алфавита, в упрощённом варианте команды однобуквенные)
и их числовых параметров, записанных также как текстовые представления целых чисел.

Исходно GERBER - совокупность команд управления фотокоординатографом, имеющим рисующую головку, которая
и является непосредственным объектом управления. Состояние головки характеризуются её текущими координатами,
установленной в данной момент диафрагмой, посредством которой будет производиться рисование, а также состоянием
источника света, луч которого непосредственно строит изображение. И сущность команд управления и заключается в
том, чтобы тем или иным определённым образом изменять это состояние.

Файл GERBER состоит из потока пакетов, состоящих, в свою очередь, из отдельных команд. Каждый пакет может
либо описывать какой-либо примитив (отрезок или засветку), либо соответствовать холостому перемещению головки,
а также может содержать в себе требование смены апертуры, состояния источика света (включить либо выключить)
или носить чисто служебный, организационный характер.

Пакет команд обособлен с обоих сторон символами "звёздочка"(\*). Список поддерживаемых команд следующий:

* Xdd - перемещение головки по оси абсцисс в точку с горизонтальной координатой X = dd.
* Ydd - перемещение головки по оси ординат в точку с вертикальной координатой Y = dd.
* D01 - включение истоника света.
* D02 - выключение источника света.
* D03 - вспышка света, формирующая засветку по текущим координатам головки.
* G54Ddd - смена апертуры. Установка апертуры с условным номером dd (с D-кодом Ddd).
* M2 - окончание работы и завершение формирования изображения.

dd - целочисленный аргумент, записанный набором цифр в обычной десятичной системе. Наличие в потоке каких-либо
других команд считается ошибочным и приводит к аварийному завершению обработки файла. Если команды X и У
находятся рядом в одном пакете, то головка будет перемещаться сразу по двум осям, формируя диагональный отрезок.
Все целевые координаты указываются всегда в милах - тысячных долях дюйма. Никаких иных метрических систем не
предусмотрено.

Порядок исполнения команд управления светом также имеет некоторые особенности. Команды включения/выключения
света (D01 и D02), где бы они ни находились физически, всегда исполняются первыми, перед всеми другими командами
пакета. Например, если первыми командами пакета являются команды перемещения (X и/или Y), за которыми
располагаются команды D01/D02, то сначала выполняются именно эти команды (D01 или D02), а последующее
перемещение головки будет производиться с уже включённым или выключенным излучением источника света. 
Таким способом формируются либо примитив отрезка (если свет включён), либо холостое передвижение головки
(если свет выключен), единственным результатом которого будет смена её текущих координат. Отрезок всегда
проводится от предыдущей точки размещения головки к её новому положению, указанному в командах пакета.

Команда вспышки D03 исполняется после команд перемещения пакета, поэтому порождаемый ей примитив отдельной
засветки будет расположен по новому месту головки.

Номер апертуры dd в команде её замены (G54Ddd) должен иметь допустимое значение. Часть этой команды Ddd образует
так называемый D-код, однозначно идентифицирующий требуемую диафрагму. Правила его формирования весьма сложны
и не будут рассматриваться в этом документе. Но следует иметь в виду, что тут возможны, в общем, два варианта,
первый из которых соответствует "ламповому" фотокоординатографу GERBER 32, а второй - "лазерному"
фотокоординатографу GERBER LASER. Тип подразумеваемого прибора (и, следовательно, диапазона допустимых D-кодов)
указывается при настройке программы генерации GERBER-файла (для САПР PCAD это программа PC_PHOTO).
Отметим лишь, что первый ("ламповый") вариант поддерживает 24 различных апертуры, а второй ("лазерный") - 255.

Анализ конкретного примера данных в формате GERBER.
---------------------------------------------------

Для лучшего уяснения приведённой выше информации рассмотрим конкретный фрагмент из реального файла GERBER. Вот
он:

G54D16\*X53384Y22154D02\*X53485Y22154D01\*X53482Y22022\*X53475Y21890\*D02\*X53700Y25890D03\*M02\*

Первый пакет состоит из одной команды смены апертуры G54D16, которая делает текущей апертуру с D-кодом D16.
Второй пакет X53384Y22154D02 содержит три команды перемещения X53384, Y22154 и команду выключения света D02.
Сначала исполняется D02, которая выключает лампу, две последующие команды передвижения объединяются в одну,
которая обеспечивает холостое передвижение головки в точку (X = 53384 мил, Y = 22154 мил) без рисования.

Пакет X53485Y22154D01 обрабатывается почти аналогично, кроме того, что исполняющаяся первой команда D01
включает свет, и последующее передвижение головки рисует отрезок от предыдущей точки (X = 53384 мил,
Y = 22154 мил) к новой точке (X = 53485 мил, Y = 22154 мил). Толщина отрезка определяется параметрами
текущей апертуры, в качестве которой выступает апертура с D-кодом D16, ранее установленная командой G54D16
первого пакета этого файла.

Следующие два пакета X53482Y22022 и X53475Y21890 содержат только команды перемещения, которое будет выполняться
с работающим светом и создаст ещё два отрезка. Составляющая следующий пакет отдельная команда D02 выключит
лампу. Наконец, следующий приведённый здесь пакет X53700Y25890D03 сначала переместит головку в точку
(X = 53700 мил, Y = 25890D03 мил) с выключенным светом, а затем, исполняя команду D03, создаст в этой точке
засветку, соответствующую по форме и размерам текущей апертуре. После создания засветки лампа вновь выключается.
Последний пакет с единственной служебной командой M02 завершит работу фотокоординаторафа и построение
изображения.
